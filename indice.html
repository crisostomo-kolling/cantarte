<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://crisostomo-kolling.github.io/cantarte/cantarte-logo-transparente.png" />
    <meta property="og:description" content="Explore e compartilhe os álbuns do Cantarte, Coro Lírico! Envie suas fotos e reviva os melhores momentos de nossos eventos em um espaço dedicado à nossa comunidade." />
    <meta property="og:title" content="Galeria de álbuns de fotos do CANTARTE" />
    
    <title>Galeria de Eventos Cantarte</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="icon" type="image/svg+xml"
        href="https://raw.githubusercontent.com/feathericons/feather/master/icons/music.svg">
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <style>
        body {
            background-color: #f3f4f6;
        }

        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .preview-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 0.5rem;
        }

        .year-section {
            margin-bottom: 2rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            margin-top: 0.5rem;
        }

        .badge-apresentacao {
            background-color: #DC143C;
        }

        .badge-confraternizacao {
            background-color: #10b981;
        }

        .badge-aniversario {
            background-color: #ec4899;
        }

        .badge-ensaio {
            background-color: #f59e0b;
        }

        .filter-button {
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border-radius: 0.25rem;
            background-color: #e5e7eb;
            color: #374151;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .filter-button:hover {
            background-color: #d1d5db;
        }

        .filter-button.active {
            background-color: #3b82f6;
            color: white;
        }

        .search-wrapper {
            position: relative;
            width: 100%;
        }

        #search-input {
            padding-right: 2.5rem;
        }

        #clear-search {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #9ca3af;
            transition: color 0.2s ease;
        }

        #clear-search:hover {
            color: #4b5563;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center py-10">
    <div class="container mx-auto px-4">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-6">Galeria de Eventos Cantarte</h1>
        <div id="search-container" class="mb-6 hidden">
            <div class="search-wrapper">
                <input type="text" id="search-input" placeholder="Pesquisar por título, local, etc..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300">
                <button id="clear-search" class="hidden">
                    <i class="fas fa-times-circle"></i>
                </button>
            </div>
        </div>
        <div id="filter-buttons" class="flex flex-wrap justify-center mb-6"></div>
        <div id="loading" class="text-center text-gray-600">Carregando eventos...</div>
        <div id="gallery" class="hidden"></div>
    </div>
    <script>
        let events = [];
        let currentFilter = 'all';
        const searchInput = document.getElementById('search-input');
        const clearSearchBtn = document.getElementById('clear-search');

        function renderGallery(filteredEvents) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            gallery.classList.remove('hidden');

            const groupedByYear = filteredEvents.reduce((acc, event) => {
                if (!acc[event.year]) acc[event.year] = [];
                acc[event.year].push(event);
                return acc;
            }, {});

            Object.keys(groupedByYear).sort((a, b) => b - a).forEach(year => {
                const yearSection = document.createElement('div');
                yearSection.className = 'year-section';
                yearSection.innerHTML = `<h2 class="text-2xl font-bold text-gray-800 mb-4">${year}</h2>`;
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6';
                groupedByYear[year].forEach(event => {
                    const card = document.createElement('div');
                    card.className = 'card bg-white rounded-lg shadow-md p-6';

                    const dateStr = (event.displayDay && event.month) ? ` (${event.displayDay}/${event.month.toString().padStart(2, '0')})` : '';
                    const categoryClass = event.category ? `badge badge-${event.category.toLowerCase().replace('ç', 'c').replace('ã', 'a')}` : '';
                    const categoryBadge = event.category ? `<span class="${categoryClass}">${event.category}</span>` : '';
                    const location = event.location ? `<p class="text-gray-600">Local: ${event.location}</p>` : '';
                    const obs = event.obs ? `<p class="text-gray-600" style="font-size: small;">${event.obs}</p>` : '';
                    const cityState = event.city && event.state ? `<p class="text-gray-600">Cidade: ${event.city}, ${event.state}</p>` : '';
                    const programLink = event.program ? `<a href="${event.program}" target="_blank" download class="text-red-500 hover:text-red-700 ml-2" title="Download do Programa"><i class="fas fa-file-pdf"></i></a>` : '';
                    
                    card.innerHTML = `
                        <a href="${event.url}" target="_blank" class="text-blue-500"><img src="${event.preview}" 
                        onerror="this.src='https://media.istockphoto.com/id/873697356/vector/notes-on-the-swirl-music-decoration-element-isolated-on-the-white-background.jpg?s=612x612&w=0&k=20&c=30dBa07rS6h1f2iHx4JzMPFEDAfb4sy9FdEvzRMXpBM='"
                        alt="${event.title}" class="preview-img mb-4">
                        <div class="flex items-center">
                            <h3 class="text-xl font-semibold text-gray-700">${event.title}${dateStr}</h3>
                            ${programLink}
                        </div>
                        ${obs}
                        ${categoryBadge}
                        ${location}
                        ${cityState}
                        </a>
                    `;
                    grid.appendChild(card);
                });
                yearSection.appendChild(grid);
                gallery.appendChild(yearSection);
            });
        }

        function updateFilterButtons(filteredEvents) {
            const filterButtons = document.getElementById('filter-buttons');
            filterButtons.innerHTML = '';
            
            const years = [...new Set(filteredEvents.map(event => event.year))];
            
            const allButton = document.createElement('button');
            allButton.className = `filter-button ${currentFilter === 'all' ? 'active' : ''}`;
            allButton.textContent = 'Todos';
            allButton.onclick = () => {
                currentFilter = 'all';
                document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                allButton.classList.add('active');
                renderGallery(filteredEvents);
            };
            filterButtons.appendChild(allButton);

            years.sort((a, b) => b - a).forEach(year => {
                const yearCount = filteredEvents.filter(event => event.year === year).length;
                const button = document.createElement('button');
                button.className = `filter-button ${currentFilter === year ? 'active' : ''}`;
                button.textContent = `${year} (${yearCount})`;
                button.onclick = () => {
                    currentFilter = year;
                    document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const yearFilteredEvents = filteredEvents.filter(event => event.year === parseInt(year));
                    renderGallery(yearFilteredEvents);
                };
                filterButtons.appendChild(button);
            });
        }
        
        function filterEvents(searchTerm) {
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            if (!lowerCaseSearchTerm) {
                renderGallery(events);
                updateFilterButtons(events);
                clearSearchBtn.classList.add('hidden');
                return;
            }
            
            const filtered = events.filter(event => 
                Object.values(event).some(value => 
                    value && String(value).toLowerCase().includes(lowerCaseSearchTerm)
                )
            );
            
            currentFilter = 'all';
            renderGallery(filtered);
            updateFilterButtons(filtered);
            clearSearchBtn.classList.remove('hidden');
        }

        searchInput.addEventListener('input', (e) => {
            filterEvents(e.target.value);
        });

        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            filterEvents('');
        });

        fetch('https://api.codetabs.com/v1/proxy/?quest=https://docs.google.com/spreadsheets/d/e/2PACX-1vR574JBcsphPozakpQEpz4BqG0eCBuoxTHlONDof5If3j7YH0fQPYeSKCJbIP7F23BXDFFOV7rGRvbQ/pub?output=csv')
            .then(response => response.text())
            .then(csvData => {
                Papa.parse(csvData, {
                    header: true,
                    skipEmptyLines: true,
                    transformHeader: header => header.trim().replace(/^"|"$/g, ''),
                    transform: (value, header) => value.trim().replace(/^"|"$/g, ''),
                    complete: (results) => {
                        events = results.data.map(row => ({
                            title: row["Titulo"],
                            obs: row["Obs"],
                            year: parseInt(row["Ano"]) || 0,
                            month: parseInt(row["Mês"]) || 1,
                            day: parseInt(row["Dia"]) || 1,
                            displayDay: row["DiaExibir"],
                            url: row["Link"],
                            preview: row["Capa"] || "https://media.istockphoto.com/id/873697356/vector/notes-on-the-swirl-music-decoration-element-isolated-on-the-white-background.jpg?s=612x612&w=0&k=20&c=30dBa07rS6h1f2iHx4JzMPFEDAfb4sy9FdEvzRMXpBM=",
                            category: row["Categoria"],
                            location: row["Local"],
                            city: row["Cidade"],
                            state: row["UF"],
                            program: row["Programa"]
                        })).filter(event => event.title && event.url && event.year);

                        events.sort((a, b) => {
                            if (a.year !== b.year) return b.year - a.year;
                            if (a.month !== b.month) return b.month - a.month;
                            return b.day - a.day;
                        });

                        document.getElementById('loading').classList.add('hidden');
                        document.getElementById('search-container').classList.remove('hidden');
                        updateFilterButtons(events);
                        renderGallery(events);
                    },
                    error: err => {
                        console.error('Erro ao parsear CSV:', err);
                        document.getElementById('loading').textContent = 'Erro ao carregar eventos.';
                    }
                });
            })
            .catch(err => {
                console.error('Erro ao carregar CSV:', err);
                document.getElementById('loading').textContent = 'Erro ao carregar eventos.';
            });
    </script>
</body>

</html>

